pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--main
function _init()
	initply()
end

function _draw()
	cls()
	map(0,0)
	spr(ply.sp,ply.x,ply.y,2,2)
	print("i want to kill myself")
end

function _update()
	
	plyupdate()
	
	camera(ply.x-64,ply.y-64)

 if btnp(❎)then
    gravity = -gravity
    gflip = true
	end
	
end

-->8
--player

function initply()
	ply=
	{
		sp=1,
		x=48,
		y=32,
		w=16,
		h=16,
		flip=false,
		dx=0,
		dy=0,
		mcx=2,
		mdy=2,
		acc=2,
		anm=0,
		rung=false,
		jmp=5,
		fall=false,
		landed=true
	}
	
	gravity = 1
	gflip=false
	friction = 0.2
end

function plyupdate()
    -- apply gravity
    ply.dy += gravity

    -- apply friction, but stop tiny movements
    ply.dx *= friction
    if abs(ply.dx) < 0.1 then ply.dx = 0 end

    -- move left/right
    if btn(⬅️) then
        ply.dx -= ply.acc
        ply.running = true
    end
    if btn(➡️) then
        ply.dx += ply.acc
        ply.running = true
    end

    -- jumping
    if btnp(⬆️) and ply.landed then
        ply.dy -= 8
        ply.landed = false
    end
    if btnp(⬇️) and ply.landed then
        ply.dy += 8
        ply.landed = false
    end

    -- handle movement with collisions
    move_player()
end

-->8
--collisions

function colisn(obj, aim, flag)
    local x, y, w, h = obj.x, obj.y, obj.w, obj.h
    local x1, x2, y1, y2

    if aim == "left" then
        x1 = x - 1
        x2 = x
        y1 = y
        y2 = y + 15 - 1
        
    elseif aim == "right" then
        x1 = x + 15
        x2 = x + 15 + 1
        y1 = y
        y2 = y + 15 - 1
        
    elseif aim == "up" then
        x1 = x
        x2 = x + 15 - 1
        y1 = y - 1
        y2 = y
        
    elseif aim == "down" then
        x1 = x
        x2 = x + 15 - 1
        y1 = y + 15
        y2 = y + 15 + 1
        
    end

    x1, x2 = flr(x1 / 8), flr(x2 / 8)
    y1, y2 = flr(y1 / 8), flr(y2 / 8)

    return fget(mget(x1, y1), flag) or fget(mget(x1, y2), flag) or 
           fget(mget(x2, y1), flag) or fget(mget(x2, y2), flag)
end

function move_player()
    local step_x = sgn(ply.dx) -- direction of movement (-1, 0, or 1)
    local step_y = sgn(ply.dy)

    -- move in small steps horizontally
    for i = 1, abs(ply.dx) do
        if colisn(ply, step_x == -1 and "left" or "right", 0) then
            ply.dx = 0
            break
        else
            ply.x += step_x
        end
    end

    -- move in small steps vertically
    for i = 1, abs(ply.dy) do
        if colisn(ply, step_y == -1 and "up" or "down", 0) then
            if step_y > 0 then
                ply.landed = true
            end
            ply.dy = 0
            break
        else
            ply.y += step_y
        end
    end
end


-->8
--platform

__gfx__
00000000000004000000000011eeeeeeeeeeee110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000004444400400011eeeeeeeeeeee110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007000000000044444444000ee112222222211ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000000444244444000ee112222222211ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000004444444244400ee221122221122ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007000000444444244444400ee221122221122ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000004400444222244440ee222211112222ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000004000004422400044ee222211112222ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000004000004444400004ee222211112222ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000004000004444400004ee222211112222ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000444444444000ee221122221122ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000004444444444400ee221122221122ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000004400000044400ee112222222211ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000004400000004400ee112222222211ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000440000000440011eeeeeeeeeeee110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000440000000440011eeeeeeeeeeee110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000101000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0304030403040304030403040304030403040304030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314131413141314131413141314131413141314131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0304000000000000000000000000000000000000030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314000000000000000000000000000000000000131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0304030400000000000000000000000000000000030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314131400000000000000000000000000000000131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0304000003040000000003040304030400000000000003040304030403040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314000013140000000013141314131400000000000013141314131413140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0304030403040304030403040304030403040000000000000000000003040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314131413141314131413141314131413140000000000000000000013140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000304000000000000000003040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000001314000000000000000013140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000304030400000304030403040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000001314131400001314131413140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000304030403040304000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000001314131413141314000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
